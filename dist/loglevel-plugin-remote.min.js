!function(e,t){if("function"==typeof define&&define.amd)define(["module","exports"],t);else if("undefined"!=typeof exports)t(module,exports);else{var r={exports:{}};t(r,r.exports),e.remote=r.exports}}(this,function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=self;if(!u)throw new Error("Plugin for browser usage only");var r=void 0;function s(e){try{return JSON.stringify(e)}catch(e){if(!r)try{var t={};t.a=t,JSON.stringify(t)}catch(e){r=e.message}if(e.message===r)return"[Circular]";throw e}}function k(c){var e="",l=0;return 1<c.length&&"string"==typeof c[0]&&(e=(e=c[0].replace(/(%?)(%([sdjo]))/g,function(e,t,r,n){if(t)return e;var o=c[l+=1],i="";switch(n){case"s":i+=o;break;case"d":i+=+o;break;case"j":i=s(o);break;case"o":var a=s(o);"{"!==a[0]&&"["!==a[0]&&(a="<"+a+">"),i=function(e){if(!Object.getOwnPropertyDescriptor||!Object.getPrototypeOf)return Object.prototype.toString.call(e).slice(8,-1);for(;e;){var t=Object.getOwnPropertyDescriptor(e,"constructor");if(void 0!==t&&"function"==typeof t.value&&""!==t.value.name)return t.value.name;e=Object.getPrototypeOf(e)}return""}(o)+a}return i})).replace(/%{2,2}/g,"%"),l+=1),c.length>l&&(e&&(e+=" "),e+=c.slice(l).join(" ")),e}var f=Object.prototype.hasOwnProperty;function w(){try{throw new Error}catch(e){return e.stack}}function n(t){var r=this,n=[],o=[];this.length=function(){return n.length},this.sent=function(){return o.length},this.push=function(e){n.push(e),n.length>t&&n.shift()},this.send=function(){return o.length||(o=n,n=[]),o},this.confirm=function(){o=[],r.content=""},this.fail=function(){var e=1+n.length+o.length-t;0<e&&(o.splice(0,e),n=o.concat(n),r.confirm())}}var o=!!w(),j=void 0,O=void 0,p=void 0;function a(e){return"["+e.timestamp+"] "+e.level.label.toUpperCase()+(e.logger?" ("+e.logger+")":"")+": "+e.message+(e.stacktrace?"\n"+e.stacktrace:"")}function c(){throw new Error("You can't set token for a not appled plugin")}var l=u.remote,v={url:"/logger",method:"POST",headers:{},token:"",tokenName:"Bearer",onUnauthorized:function(){this.token=void 0},timeout:0,interval:1e3,level:"trace",backoff:{multiplier:2,jitter:.1,limit:3e4},capacity:0,stacktrace:{levels:["trace","warn","error"],depth:3,excess:0},timestamp:function(){return(new Date).toISOString()},format:a},remote={noConflict:function(){return u.remote===remote&&(u.remote=l),remote},plain:a,json:function(e){return e.level=e.level.label,e},apply:function(e,t){if(!e||!e.getLogger)throw new TypeError("Argument is not a root loglevel object");if(j)throw new Error("You can assign a plugin only one time");j=e;var h=function e(){for(var t={},r=0;r<arguments.length;r+=1){var n=Object(arguments[r]);for(var o in n)f.call(n,o)&&(t[o]="object"!==i(n[o])||Array.isArray(n[o])?n[o]:e(t[o],n[o]))}return t}(v,t);h.capacity=h.capacity||500;var r=h.backoff,a="object"===(void 0===r?"undefined":i(r))?function(e){var t=e*r.multiplier;return t>r.limit&&(t=r.limit),t+=t*r.jitter*Math.random()}:r,c=h.interval,m=void 0,d=void 0,l=!1,s=!1,y=new n(h.capacity);function b(){if(!s&&!l&&void 0!==h.token){if(!y.sent()){if(!y.length())return;var e=y.send();y.content=d?'{"logs":['+e.join(",")+"]}":e.join("\n")}l=!0;var t=h.headers;t["Content-Type"]=m,h.token&&(t.Authorization=h.tokenName+" "+h.token);var r=new AbortController,n=u.fetch(h.url,{method:h.method,headers:t,signal:r.signal,body:y.content}),o=void 0;h.timeout&&(o=u.setTimeout(function(){l=!1,r.abort("Timeout reached"),i()},h.timeout)),n.then(function(e){if(l=!1,u.clearTimeout(o),200===e.status)c=h.interval,y.confirm(),i(!0);else{if(401===e.status){var t=h.token;h.onUnauthorized(t)}i()}})}function i(e){e||(c=a(c||1),y.fail()),s=!0,u.setTimeout(function(){s=!1,b()},c)}}return O=e.methodFactory,p=function(s,e,u){var f=O(s,e,u),p=o&&h.stacktrace.levels.some(function(e){return e===s}),v=j.levels[s.toUpperCase()],g=v>=j.levels[h.level.toUpperCase()];return function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(g){var n=h.timestamp(),o=p?w():"";if(o){var i=o.split("\n");i.splice(0,h.stacktrace.excess+3);var a=h.stacktrace.depth;if(a&&i.length!==a+1)o=i.splice(0,a).join("\n"),i.length&&(o+="\n    and "+i.length+" more");else o=i.join("\n")}var c=h.format({message:k(t),level:{label:s,value:v},logger:u||"",timestamp:n,stacktrace:o});void 0===d&&(m=(d="string"!=typeof c)?"application/json":"text/plain");var l="";if(d)try{l+=JSON.stringify(c)}catch(e){return f.apply(void 0,t),void j.getLogger("logger").error(e)}else l+=c;y.push(l),b()}f.apply(void 0,t)}},e.methodFactory=p,e.setLevel(e.getLevel()),remote.setToken=function(e){h.token=e,b()},e},disable:function(){if(!j)throw new Error("You can't disable a not appled plugin");if(p!==j.methodFactory)throw new Error("You can't disable a plugin after appling another plugin");j.methodFactory=O,j.setLevel(j.getLevel()),j=void 0,remote.setToken=c},setToken:c};t.default=remote,e.exports=t.default});